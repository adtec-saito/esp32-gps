<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ESP32 GPS Sender</title>

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  margin: 40px;
}

h2 {
  font-size: 70px;
  margin-bottom: 40px;
}

#coords {
  font-size: 80px;
  font-weight: bold;
  margin: 60px 0;
  line-height: 1.4;
}

#status {
  font-size: 50px;
  margin-bottom: 40px;
}

button {
  font-size: 60px;
  padding: 40px 80px;
  border-radius: 25px;
  border: none;
  background-color: #007bff;
  color: white;
}
</style>

</head>
<body>

<h2>座標送信</h2>

<p id="coords">未取得</p>
<p id="status"></p>

<button onclick="getLocation()">取得</button>

<script>
const ESP32_IP = "http://10.99.147.182";

function getLocation(){
  if(!navigator.geolocation){
    alert("GPS未対応");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    function(pos){
      let lat = pos.coords.latitude;
      let lon = pos.coords.longitude;

      document.getElementById("coords").innerHTML =
        lat.toFixed(6) + "<br>" + lon.toFixed(6);

      sendToESP32(lat, lon);
    },
    function(err){
      alert("位置情報エラー: " + err.message);
    },
    { enableHighAccuracy: true }
  );
}

function sendToESP32(lat, lon){
  fetch(`${ESP32_IP}/location?lat=${lat}&lon=${lon}`, {
    method: "GET",
    mode: "no-cors"
  })
  .then(() => {
    document.getElementById("status").innerHTML = "送信OK";
    document.getElementById("status").style.color = "green";
  })
  .catch(() => {
    document.getElementById("status").innerHTML = "送信失敗";
    document.getElementById("status").style.color = "red";
  });
}
</script>

</body>
</html>
