<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<link rel="stylesheet"
 href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script
 src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body { margin:0; }
#map { height:80vh; }
button {
  width:100%;
  font-size:40px;
  padding:30px;
}
#status{
  text-align:center;
  font-size:30px;
}
</style>
</head>
<body>

<div id="map"></div>
<button onclick="getLocation()">現在位置取得</button>
<div id="status">待機中</div>

<script>

let map = L.map('map').setView([35,139], 5);
let marker = null;

L.tileLayer(
'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
{ attribution:'© OpenStreetMap'}
).addTo(map);

function getLocation(){

  document.getElementById("status").innerHTML = "取得中...";

  if(!navigator.geolocation){
    document.getElementById("status").innerHTML = "GPS未対応";
    return;
  }

  navigator.geolocation.getCurrentPosition(
    function(pos){

      let lat = pos.coords.latitude;
      let lon = pos.coords.longitude;

      document.getElementById("status").innerHTML =
        lat.toFixed(6) + " , " + lon.toFixed(6);

      map.setView([lat,lon], 18);

      if(marker){
        marker.setLatLng([lat,lon]);
      }else{
        marker = L.marker([lat,lon]).addTo(map);
      }

    },
    function(err){
      document.getElementById("status").innerHTML =
        "位置情報エラー: " + err.message;
    },
    { enableHighAccuracy:true }
  );
}

</script>
</body>
</html>
