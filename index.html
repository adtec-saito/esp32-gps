<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ESP32 GPS Sender</title>

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  margin-top: 50px;
}

h2 {
  font-size: 40px;
}

#coords {
  font-size: 32px;
  margin: 30px 0;
}

#status {
  font-size: 26px;
  color: green;
  margin-bottom: 20px;
}

button {
  font-size: 30px;
  padding: 20px 40px;
  border-radius: 15px;
  border: none;
  background-color: #007bff;
  color: white;
}
</style>

</head>
<body>

<h2>ESP32へ座標送信</h2>

<p id="coords">未取得</p>
<p id="status"></p>

<button onclick="getLocation()">座標取得</button>

<script>
const ESP32_IP = "http://10.99.147.182";

function getLocation(){
  if(!navigator.geolocation){
    alert("GPS未対応");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    function(pos){
      let lat = pos.coords.latitude;
      let lon = pos.coords.longitude;

      document.getElementById("coords").innerHTML =
        "緯度: " + lat + "<br>経度: " + lon;

      sendToESP32(lat, lon);
    },
    function(err){
      alert("位置情報エラー: " + err.message);
    },
    { enableHighAccuracy: true }
  );
}

function sendToESP32(lat, lon){
  fetch(`${ESP32_IP}/location?lat=${lat}&lon=${lon}`, {
    method: "GET",
    mode: "no-cors"
  })
  .then(() => {
    document.getElementById("status").innerHTML = "ESP32へ送信しました";
  })
  .catch(() => {
    document.getElementById("status").innerHTML = "送信失敗";
  });
}
</script>

</body>
</html>
